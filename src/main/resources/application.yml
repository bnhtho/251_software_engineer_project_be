# =========================================================
# 1. CẤU HÌNH MẶC ĐỊNH / DEV (Chạy Localhost)
# =========================================================
server:
  port: 8081
  address: 0.0.0.0
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  error:
    include-message: always
    include-binding-errors: always
    include-exception: false
    include-stacktrace: never

spring:
  profiles:
    active: dev
  datasource:
    url: jdbc:mysql://localhost:3307/tutor_system?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC&useUnicode=true&characterEncoding=UTF-8
    username: root
    password: admin123
  jpa:
    database-platform: org.hibernate.dialect.MySQL8Dialect
    hibernate:
      ddl-auto: none
      show-sql: true
      jdbc:
        time_zone: UTC
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
  jackson:
    time-zone: Asia/Ho_Chi_Minh
    serialization:
      write-dates-as-timestamps: false

app:
  jwt:
    secret: gixcprMftqxTdjUeWJ0dvTrAqoUPjcROc2U8YRiWbX0=
    expiration: 43200000
  cors:
    allowed-origins:
      - http://localhost:5173
      - http://localhost:3000

---
# =========================================================
# 2. PROFILE DOCKER (Chạy trong Docker Network Local)
# =========================================================
spring:
  config:
    activate:
      on-profile: docker
  datasource:
    url: jdbc:mysql://mysql:3306/tutor_system?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC&useUnicode=true&characterEncoding=UTF-8
    username: root
    password: admin123
  jackson:
    time-zone: Asia/Ho_Chi_Minh
    serialization:
      write-dates-as-timestamps: false

server:
  port: 8081
  address: 0.0.0.0
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true

---
# =========================================================
# 3. PROFILE PROD (Dùng cho Render + TiDB Cloud)
# =========================================================
spring:
  config:
    activate:
      on-profile: prod
  datasource:
    # Lấy giá trị từ biến môi trường trên Render
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false    # Tắt log SQL để đỡ rối log trên server
    database-platform: org.hibernate.dialect.MySQL8Dialect

server:
  # Render sẽ tự động bơm PORT vào, nếu không có thì dùng 8080
  port: ${PORT:8080}
  address: 0.0.0.0

app:
  jwt:
    # Lấy secret từ biến môi trường JWT_SECRET trên Render.
    # Nếu quên set, nó sẽ dùng chuỗi mặc định sau dấu : (để không bị lỗi)
    secret: ${JWT_SECRET:gixcprMftqxTdjUeWJ0dvTrAqoUPjcROc2U8YRiWbX0=}
    expiration: 43200000
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:5173,http://localhost:3000}